<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="https://cdn.socket.io/4.x/socket.io.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <button class="menu-toggle" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>
    <button id="darkModeToggle" class="theme-toggle">
        <span id="themeIcon">üåô</span>
        <span id="themeLabel">Dark Mode</span>
    </button>

    <div id="gas-popup" style="
        display: none;
        position: fixed;
        top: 10%;
        left: 50%;
        transform: translateX(-50%);
        background-color: #ff4d4d;
        color: white;
        padding: 20px 40px;
        border-radius: 10px;
        font-weight: bold;
        box-shadow: 0 0 20px rgba(0,0,0,0.5);
        z-index: 1000;
        font-size: 1.4rem;
        text-align: center;">
        ‚ö†Ô∏è Ph√°t hi·ªán kh√≠ GAS! Ki·ªÉm tra ngay!
    </div>



    <div id="face-popup" style="
        display: none;  
        position: fixed;
        top: 10%;
        left: 50%;
        transform: translateX(-50%);
        background-color: #ff8800;
        color: white;
        padding: 20px 40px;
        border-radius: 10px;
        font-weight: bold;
        box-shadow: 0 0 20px rgba(0,0,0,0.5);
        z-index: 1000;
        font-size: 1.4rem;
        text-align: center;">
        ‚ö†Ô∏è Ph√°t hi·ªán ng∆∞·ªùi l·∫° tr∆∞·ªõc c·ª≠a!
    </div>

      
    <div class="sidebar" id="sidebar">
        <h2>SmartHome</h2>
        <ul class="nav">
            <li><a href="#" class="active" onclick="switchTab('overview', this)"><i class="fas fa-home"></i> <span>T·ªïng quan</span></a></li>
            <li><a href="#" onclick="switchTab('energy', this)"><i class="fas fa-bolt"></i> <span>NƒÉng l∆∞·ª£ng</span></a></li>
            <li><a href="#" onclick="switchTab('history', this)"><i class="fas fa-clock-rotate-left"></i> <span>L·ªãch s·ª≠</span></a></li>
            <li><a href="/" onclick="localStorage.removeItem('hassToken')">
    <i class="fas fa-sign-out-alt"></i> <span>ƒêƒÉng xu·∫•t</span>
  </a></li>
        </ul>
        
    </div>

    <div class="tab-content active" id="overviewTab">
        <div class="container" id="mainContainer">
            <div class="page-header">
                <h1 id="pageTitle" class="page-title">T·ªïng quan</h1>
            </div>
              
            <div class="dashboard">
                <!-- Yeelight Control Card -->
                <div class="card">
                    <h2>ƒêi·ªÅu Khi·ªÉn ƒê√®n</h2>
                    <div class="light-controls">
                        <div class="light-item">
                            <span class="light-name" data-entity="light.192_168_1_18">ƒê√®n Ph√≤ng Kh√°ch</span>
                            <label class="switch">
                                <input type="checkbox" id="livingRoomLight">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="brightness-control">
                            <p>ƒê·ªô s√°ng: <span id="brightnessValue">70</span>%</p>
                            <input type="range" min="1" max="100" value="70" class="brightness-slider" id="livingRoomBrightness">
                        </div>

                        <div class="light-item">
                            <span class="light-name" data-entity="input_boolean.den_2">ƒê√®n Ph√≤ng Ng·ªß</span>
                            <label class="switch">
                                <input type="checkbox" id="bedroomLight">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="brightness-control">
                            <p>ƒê·ªô s√°ng: <span id="bedroomBrightnessValue">50</span>%</p>
                            <input type="range" min="1" max="100" value="50" class="brightness-slider" id="bedroomBrightness">
                        </div>
                    </div>
                    
                </div>

                <!-- Temperature Card -->
                <div class="card">
                    <h2>Nhi·ªát ƒê·ªô</h2>
                    <div class="sensor-data">
                        <div class="sensor-value" id="temperatureValue">--¬∞C</div>
                        
                    </div>
                    <canvas id="temperatureChart" height="200"></canvas>
                </div>

                <!-- Humidity Card -->
                <div class="card">
                    <h2>ƒê·ªô ·∫®m</h2>
                    <div class="sensor-data">
                        <div class="sensor-value" id="humidityValue">--%</div>
                    </div>
                    <canvas id="humidityChart" height="200"></canvas>
                </div>
                <div class="camera-preview" style="text-align: center; margin: 20px 0;">
                    <h3>Camera an ninh 3</h3>
                    <img src="/video_feed" id="remoteCamera" width="100%" style="border-radius: 10px;">
                    
                </div>

            </div>
        </div>
    </div>
    <!-- C√°c tab kh√°c -->
    <div id="energyTab" class="tab-content">
        <div class="container"> 
            <div class="page-header">
                <h1 id="pageTitle" class="page-title">NƒÉng l∆∞·ª£ng</h1>
            </div>
            <div class="energy-grid">
                <div class="card">
                    <h3>üîå Ch·ªâ s·ªë ƒëi·ªán</h3>
                    <div class="energy-info">
                    <div><i class="fas fa-tachometer-alt"></i> Ch·ªâ s·ªë ƒë·∫ßu k·ª≥: <span id="startIndex">--</span></div>
                    <div><i class="fas fa-tachometer-alt"></i> Ch·ªâ s·ªë t·∫°m ch·ªët: <span id="currentIndex">--</span></div>
                    <div><i class="fas fa-calendar-alt"></i> Ng√†y ƒë·∫ßu k·ª≥: <span id="startDay">--</span></div>
                    <div><i class="fas fa-calendar-check"></i> Ng√†y t·∫°m ch·ªët: <span id="endDay">--</span></div>
                </div>
                </div>
            
                <div class="card">
                    <h3>üåü S·∫£n l∆∞·ª£ng ti√™u th·ª•</h3>
                    <div class="energy-info">
                        <div><i class="fas fa-bolt"></i> S·∫£n l∆∞·ª£ng h√¥m qua: <span id="dailyUsage1">--</span></div>
                        <div><i class="fas fa-bolt"></i> S·∫£n l∆∞·ª£ng h√¥m nay: <span id="dailyUsage2">--</span></div>
                        <div><i class="fas fa-bolt"></i> S·∫£n l∆∞·ª£ng th√°ng n√†y: <span id="monthlyUsage">--</span></div>
                    </div>
                </div>
            
                <div class="card">
                    <h3>üí∞ H√≥a ƒë∆°n ƒëi·ªán</h3>
                    <div class="energy-info">
                        <div><i class="fas fa-money-bill-wave"></i> Ti·ªÅn ƒëi·ªán h√¥m qua: <span id="dailyCost1">--</span></div>
                        <div><i class="fas fa-money-bill-wave"></i> Ti·ªÅn ƒëi·ªán h√¥m nay: <span id="dailyCost2">--</span></div>
                        <div><i class="fas fa-wallet"></i> Ti·ªÅn ƒëi·ªán th√°ng n√†y: <span id="monthlyCost">--</span></div>
                        <div><i class="fas fa-hand-holding-usd"></i> Ti·ªÅn n·ª£: <span id="debt">--</span></div>
                        <div><i class="fas fa-file-invoice"></i> H√≥a ƒë∆°n c≈©: <span id="oldBill">--</span></div>
                    <div><i class="fas fa-exclamation-triangle"></i> L·ªãch c·∫Øt ƒëi·ªán: <span id="cutSchedule">--</span></div>
                    <div><i class="fas fa-clock"></i> L·∫ßn c·∫≠p nh·∫≠t cu·ªëi: <span id="lastUpdate">--</span></div>
                </div>
                </div>
            </div>
        </div>
    </div>
      
    <div class="tab-content" id="historyTab">
        <div class="container">
            <h1>L·ªãch s·ª≠</h1>
            <p>L·ªãch s·ª≠ ho·∫°t ƒë·ªông s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ·ªü ƒë√¢y.</p>
               <!-- <div class="card">
                    <h2>·∫¢nh Ng∆∞·ªùi L·∫° G·∫ßn Nh·∫•t</h2>
                    <img id="strangerImage" src="" alt="Ch∆∞a c√≥ ·∫£nh" style="max-width: 100%; border: 2px solid red; border-radius: 10px;"> */
                </div>-->
                <div style="margin-bottom: 20px;">
                    <label for="historyType">Ch·ªçn lo·∫°i l·ªãch s·ª≠:</label>
                    <select id="historyType" onchange="switchHistoryView(this.value)" style="padding: 6px; border-radius: 6px;">
                            <option value="stranger">Ph√°t hi·ªán ng∆∞·ªùi l·∫°</option>
                            <option value="gas">Ph√°t hi·ªán kh√≠ GAS</option>
                            <option value="electricPrice">Bi·ªÉu ƒë·ªì gi√° ƒëi·ªán (VNƒê)</option>
                            <option value="electricUsage">Bi·ªÉu ƒë·ªì ƒëi·ªán nƒÉng ti√™u th·ª• (kWh)</option>
                    </select>
                </div>
                <!-- L·ªãch s·ª≠ ng∆∞·ªùi l·∫° -->
<div id="historyStranger" class="history-section">
    <div class="card">
        <h2>Ph√°t hi·ªán ng∆∞·ªùi l·∫°</h2>
        <ul id="strangerLog" style="padding-left: 20px;"></ul>
    </div>
</div>

<!-- L·ªãch s·ª≠ kh√≠ GAS -->
<div id="historyGas" class="history-section" style="display:none;">
    <div class="card">
        <h2>Ph√°t hi·ªán kh√≠ GAS</h2>
        <ul id="gasLog" style="padding-left: 20px;"></ul>
    </div>
</div>

<!-- Bi·ªÉu ƒë·ªì gi√° ƒëi·ªán -->
<div id="historyElectricPrice" class="history-section" style="display:none;">
    <div class="card">
        <h2>Gi√° ƒëi·ªán theo ng√†y</h2>
        <canvas id="priceChart" height="200"></canvas>
    </div>
</div>

<!-- Bi·ªÉu ƒë·ªì ti√™u th·ª• ƒëi·ªán -->
<div id="historyElectricUsage" class="history-section" style="display:none;">
    <div class="card">
        <h2>Ti√™u th·ª• ƒëi·ªán theo ng√†y</h2>
        <canvas id="usageChart" height="200"></canvas>
    </div>
</div>
               
        </div>
    </div>

    <div class="status-bar">
         <div class="status-indicator">
            <div class="indicator disconnected" id="connectionStatus"></div>
                <span id="connectionText">ƒêang k·∫øt n·ªëi v·ªõi M√°y ch·ªß...</span>
            </div>
            <div>
                <span id="lastUpdated">Ch∆∞a c√≥ d·ªØ li·ªáu</span>
            </div>
        </div>
        
    </div>
    <div id="scheduleModal" class="modal" style="display:none;">
        <div class="modal-content">
        <span class="close-button">&times;</span>
        <h3 id="modalTitle">C√†i ƒë·∫∑t ƒë√®n</h3>
        <div style="margin-bottom: 10px;">
            <button onclick="switchTabContent('scheduleTab')">L√™n l·ªãch</button>
            <button onclick="switchTabContent('timerTab')">H·∫πn gi·ªù</button>
            <button onclick="switchTabContent('deleteTab')">Xo√° l·ªãch</button>

        </div>
    
        <!-- Tab 1: L√™n l·ªãch -->
        <div id="scheduleTab">
            <form id="scheduleForm">
            <input type="hidden" name="entity_id" id="scheduleEntity">
            <input type="text" name="alias" placeholder="T√™n l·ªãch tr√¨nh" required />
            <input type="time" name="time" required />
            <select name="action">
                <option value="turn_on">B·∫≠t</option>
                <option value="turn_off">T·∫Øt</option>
            </select>
            <button type="submit">T·∫°o l·ªãch</button>
            </form>
        </div>
    
        <!-- Tab 2: H·∫πn gi·ªù -->
        <div id="timerTab" style="display:none;">
            <form id="timerForm">
              <input type="hidden" name="entity_id" id="timerEntity">
              <label>H·∫πn t·∫Øt sau (ph√∫t):</label>
              <input type="number" name="minutes" min="1" required>
              <button type="submit">H·∫πn gi·ªù</button>
            </form>
            <div id="countdownDisplay" style="margin-top: 15px; font-weight: bold;"></div>
            <button id="cancelTimerButton" style="margin-top: 10px; display: none;">D·ª´ng h·∫πn gi·ªù</button>
        </div>
          
        <!-- Tab 3: Xo√° l·ªãch -->
        <div id="deleteTab" style="display:none;">
            <form id="deleteForm">
            <input type="text" name="automation_alias" placeholder="T√™n l·ªãch tr√¨nh c·∫ßn xo√°" required />
            <button type="submit" style="margin-top: 10px;">Xo√° l·ªãch tr√¨nh</button>
            </form>
        </div>
  
        </div>
    </div>
<script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
